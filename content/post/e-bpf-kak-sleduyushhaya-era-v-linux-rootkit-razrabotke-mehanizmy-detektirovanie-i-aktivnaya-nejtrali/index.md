---
title: "eBPF –∫–∞–∫ —Å–ª–µ–¥—É—é—â–∞—è —ç—Ä–∞ –≤ Linux Rootkit-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: –º–µ—Ö–∞–Ω–∏–∑–º—ã, –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω–∞—è –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è"
date: 2026-05-03
draft: false
description: "eBPF –∫–∞–∫ —Å–ª–µ–¥—É—é—â–∞—è —ç—Ä–∞ –≤ Linux Rootkit-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: –º–µ—Ö–∞–Ω–∏–∑–º—ã, –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω–∞—è –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è"
image: "/cdn/blog-cdn/large_6877c420b128d8fdaaa4e99b_blog_e_BPF_Offensive_Capabilities_0bccaaa366.png"
---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ

–° –º–æ–º–µ–Ω—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è eBPF (Extended Berkeley Packet Filter) –≤ —è–¥—Ä–µ Linux –≤–µ—Ä—Å–∏–∏ 3.18 —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Å–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.  
–û–¥–Ω–∞–∫–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ eBPF –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –±–∞–π—Ç–∫–æ–¥–∞ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —è–¥—Ä–∞**, —á—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –≤ **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ kernel-space –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π**.

–í –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≥–æ–¥—ã (2022‚Äì2025) –±—ã–ª–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∫–µ–π—Å—ã, –≥–¥–µ eBPF –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ —Ü–µ–ª—è—Ö –æ–±—Ö–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã, —Å–∫—Ä—ã—Ç–∏—è —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.  
–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫:

- –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö eBPF-–ø—Ä–æ–≥—Ä–∞–º–º
- –∞–Ω–∞–ª–∏–∑—É –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –∞–∫—Ç–∏–≤–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –º–æ–º–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

---

## 2. eBPF –∫–∞–∫ —Ä—É—Ç–∫–∏—Ç-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

### 2.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ eBPF

eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–∞–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (–±–∞–π—Ç–∫–æ–¥), –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–æ–π –≤ —è–¥—Ä–µ. –ö–æ–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤:

`int bpf(int cmd, union bpf_attr *attr, unsigned int size);`

–¢–∏–ø `cmd = 5` (`BPF_PROG_LOAD`) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –∫–æ–¥–∞ –≤ —è–¥—Ä–æ.  
–î–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —è–¥—Ä–∞, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–º –ø—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –æ–±–ª–∞—Å—Ç—è–º –ø–∞–º—è—Ç–∏, –æ–¥–Ω–∞–∫–æ **—ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –∏–ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤**.

---

### 2.2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç–∏

|–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π —Ä—É—Ç–∫–∏—Ç|eBPF-–±—ç–∫–¥–æ—Ä|
|---|---|
|–¢—Ä–µ–±—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è —è–¥—Ä–∞ (LKM)|–†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ LKM, —á–µ—Ä–µ–∑ syscall|
|–í—ã–∑—ã–≤–∞–µ—Ç –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –≤ `dmesg`/`lsmod`|–ù–µ–∑–∞–º–µ—Ç–µ–Ω –¥–ª—è `lsmod`, `modinfo`|
|–¢—Ä–µ–±—É–µ—Ç root-–¥–æ—Å—Ç—É–ø|–ú–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–µ–¥—Ä—ë–Ω —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ—Å—Å —Å `CAP_BPF`|
|–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Integrity Check|–ù–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥–æ–≤ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ|

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, eBPF —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –¥–ª—è **in-memory —Ä—É—Ç–∫–∏—Ç–∞**, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ö–æ–¥—è—â–µ–≥–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è LKM.

---

## 3. –í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ eBPF

### 3.1. –ü–µ—Ä–µ—Ö–≤–∞—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

–ò—Å–ø–æ–ª—å–∑—É—è `kprobes`, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å eBPF-–ø—Ä–æ–≥—Ä–∞–º–º—É, –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—â—É—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã —è–¥—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

`SEC("kprobe/sys_execve")`
`int kprobe__sys_execve(struct pt_regs *ctx)`
`{`
    `char comm[16];`
    `bpf_get_current_comm(&comm, sizeof(comm));`
    `if (comm[0] == 's' && comm[1] == 'h') {`
        `bpf_override_return(ctx, -EPERM);`
    `}`
    `return 0;`
`}`

–≠—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø—É—Å–∫ `sh` –∏–ª–∏ `bash`, —Å–æ–∑–¥–∞–≤–∞—è –∏–ª–ª—é–∑–∏—é ‚Äú–∑–∞–≤–∏—Å–∞–Ω–∏—è‚Äù –ø—Ä–æ—Ü–µ—Å—Å–∞.  
–¢–∞–∫–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Å—Ç–æ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è.

---

### 3.2. –°–æ–∫—Ä—ã—Ç–∏–µ —Å–µ—Ç–µ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–° –ø–æ–º–æ—â—å—é `socket filter` eBPF –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞, –∏—Å–∫–ª—é—á–∞—è C2-—Ç—Ä–∞—Ñ–∏–∫ –∏–∑ –∑–∞—Ö–≤–∞—Ç–∞ `tcpdump`, `Wireshark` –∏ `netstat`:

`SEC("socket")`
`int socket_filter(struct __sk_buff *skb)`
`{`
    `if (skb->remote_port == 4444) return 0; // —Å–∫—Ä—ã—Ç—ã–π C2`
    `return 1;`
`}`

---

### 3.3. –ü–æ–¥–º–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

eBPF –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —á—Ç–µ–Ω–∏–µ –∏–∑ `/proc` –∏–ª–∏ `/sys` –∏ –ø–æ–¥–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã):

`SEC("kprobe/vfs_read")`
`int hide_proc(struct pt_regs *ctx) {`
`char buf[128];`
`bpf_probe_read(&buf, sizeof(buf), (void *)PT_REGS_PARM2(ctx));`
`if (bpf_strncmp(buf, "malware", 7) == 0)`
`bpf_probe_write_user((void *)PT_REGS_PARM2(ctx), "init", 4);`
`return 0; }`

---

## 4. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ eBPF-–∑–∞–≥—Ä—É–∑–æ–∫ (userspace detection)

–ù–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º —Ñ–∞–∫—Ç –≤—ã–∑–æ–≤–∞ `bpf()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `cmd=5`.

### 4.1. AuditD

`auditctl -a always,exit -F arch=b64 -S bpf -F a0=5 -F key=bpf_prog_load`

### 4.2. Falco Rule

- `rule: eBPF Program Load`
  `desc: Detects eBPF program loading into kernel`
  `condition: evt.type=bpf and evt.arg.cmd=5`
  `output: "eBPF load detected: proc=%proc.name pid=%proc.pid user=%user.name"`
  `priority: WARNING`

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ñ–∞–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–æ –Ω–µ –¥–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã.

---

## 5. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —è–¥—Ä–∞ (kernel-level detection)

–î–ª—è –≥–ª—É–±–∏–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–∞–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ `bpf()` –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞.

### 5.1. eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞ eBPF

`SEC("kprobe/sys_bpf")`
`int kprobe__sys_bpf(struct pt_regs *ctx, int cmd, union bpf_attr *attr)`
`{`
    `if (cmd == BPF_PROG_LOAD) {`
        `struct event_t evt = {};`
        `evt.pid = bpf_get_current_pid_tgid();`
        `bpf_get_current_comm(&evt.comm, sizeof(evt.comm));`
        `evt.type = attr->prog_type;`
        `evt.cnt = attr->insn_cnt;`
        `bpf_probe_read_str(&evt.name, sizeof(evt.name), attr->prog_name);`
        `events.perf_submit(ctx, &evt, sizeof(evt));`
    `}`
    `return 0;`S
`}`

–≠—Ç–æ—Ç –∫–æ–¥ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–º—è –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—ë —Ç–∏–ø (`kprobe`, `tracepoint`, `xdp`, –∏ —Ç.–¥.), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ perf-–∫–∞–Ω–∞–ª.

---

## 6. –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ eBPF-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

–ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

`struct bpf_insn {`
  `__u8 code;`
  `__u8 dst_reg:4;`
  `__u8 src_reg:4;`
  `__s16 off;`
  `__s32 imm;`
`};`

–ö–ª—é—á–µ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ—Å—Ç–∏ ‚Äî –Ω–∞–ª–∏—á–∏–µ –≤—ã–∑–æ–≤–æ–≤ helper-—Ñ—É–Ω–∫—Ü–∏–π —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏:

| Helper               | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ |
| -------------------- | ---------------------------------------- | ------------- |
| bpf_override_returnS | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞   | üî¥            |
| bpf_probe_write_user | –ó–∞–ø–∏—Å—å –≤ –ø–∞–º—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è             | üî¥            |
| bpf_copy_from_user   | –ù–µ–∑–∞–º–µ—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | üü†            |
| bpf_map_update_elem  | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —è–¥—Ä–µ        | üü°            |

---

## 7. –ê–∫—Ç–∏–≤–Ω–∞—è –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è (kernel prevention)

–ú–æ–∂–Ω–æ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –∏ **—Ä–∞–∑—Ä—É—à–∞—Ç—å** –∑–∞–≥—Ä—É–∑–∫—É –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ eBPF.

### 7.1. –ú–µ—Ç–æ–¥ –ø–æ–¥–º–µ–Ω—ã –ø–µ—Ä–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

`SEC("kprobe/sys_bpf")`
`int prevent_bpf(struct pt_regs *ctx, int cmd, union bpf_attr *attr)`
`{`
    `if (cmd == BPF_PROG_LOAD) {`
        `struct bpf_insn bad = { .code = 0x95 }; // BPF_EXIT_INSN`
        `bpf_probe_write_user((void *)attr->insns, &bad, sizeof(bad));`
    `}`
    `return 0;`
`}`

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –∑–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∞ `BPF_EXIT`, –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—á–∏—Ç–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –ø—É—Å—Ç–æ–π.  
–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ—Ç–∫–∞–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è —è–¥—Ä–∞.

---

## 8. Tail Calls –∏ –æ–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞

eBPF –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç –≤ 1 –º–ª–Ω –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–∏–∫–ª–æ–≤. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏ –æ–±—Ö–æ–¥—è—Ç —ç—Ç–æ, —Å–≤—è–∑—ã–≤–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º —á–µ—Ä–µ–∑ **tail calls**:

`bpf_tail_call(ctx, &prog_array, 1);`

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å **—Ü–µ–ø–æ—á–∫—É –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º**, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —Ñ–∞–∫—Ç—É –∑–∞–≥—Ä—É–∑–∫–∏, –Ω–æ –∏ –ø–æ —Ü–µ–ø–æ—á–∫–µ –≤—ã–∑–æ–≤–æ–≤ `bpf_tail_call`.

---

## 9. –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–µ–π—Å–∞: ExecHijack

–í—Ä–µ–¥–æ–Ω–æ—Å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –≤ —Ö–æ–¥–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ Solar 4RAYS, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ tracepoint `sys_enter_execve` –∏ helper `bpf_probe_write_user()` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞–µ–º–æ–≥–æ –±–∏–Ω–∞—Ä—è.  
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã–∑–æ–≤ `/bin/whoami` –ø—Ä–∏–≤–æ–¥–∏–ª –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é `/usr/bin/backdoor`.

eBPF-Prevention –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–ª –º–æ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª prog_name –∏ helper_id, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—Å—Ç–∞–≤–ª—è–ª BPF_EXIT_INSN() –≤ —Ç–µ–ª–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—é.

---

## 10. –ò—Ç–æ–≥: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞—â–∏—Ç—ã —É—Ä–æ–≤–Ω—è eBPF

|–£—Ä–æ–≤–µ–Ω—å|–ú–µ—Ç–æ–¥|–≠—Ñ—Ñ–µ–∫—Ç|
|---|---|---|
|Userspace|AuditD / Falco|–§–∏–∫—Å–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏|
|Kernel-level|eBPF-–¥–µ—Ç–µ–∫—Ç–æ—Ä|–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ helpers|
|Kernel prevention|BPF_EXIT –ø–æ–¥–º–µ–Ω–∞|–ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã|
|Post-analysis|perf ‚Üí SIEM (Splunk / Graylog)|–ü–µ—Ä–µ–¥–∞—ë—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –≤ SOC|
|Policy layer|whitelisting –ø–æ prog_name / helper_id|–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ eBPF|

---

## 11. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

eBPF —Å—Ç–∞–ª —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –Ω–æ–≤–æ–π –ø–∞—Ä–∞–¥–∏–≥–º—ã –≤ –æ–±–ª–∞—Å—Ç–∏ —Ä—É—Ç–∫–∏—Ç–æ–≤.  
–û–Ω –±–µ–∑–æ–ø–∞—Å–µ–Ω, –ø–æ–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º ‚Äî –Ω–æ –≤ —Ä—É–∫–∞—Ö –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ —Å–ø–æ—Å–æ–±–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–æ–π—Ç–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, SELinux –∏ AppArmor.

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è ‚ÄúSecurity for eBPF‚Äù**, –≤–∫–ª—é—á–∞—é—â–µ–≥–æ:

- –∞—É–¥–∏—Ç –≤—Å–µ—Ö eBPF-–∑–∞–≥—Ä—É–∑–æ–∫;
- –ø–µ—Ä–µ—Ö–≤–∞—Ç –∏ –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `bpf_attr`;
- —Å–∏–≥–Ω–∞—Ç—É—Ä–Ω—ã–π –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ helpers;
- –∞–∫—Ç–∏–≤–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –Ω–∞ kernel-—É—Ä–æ–≤–Ω–µ;
- –∏ —ç–∫—Å–ø–æ—Ä—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤ SIEM –¥–ª—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏.

**–ï—Å–ª–∏ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å –µ—â—ë –∫–ª–∞—Å—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç**, —Ç–æ –ø—Ä–∏–≥–ª–∞—à–∞—é –≤ —Å–≤–æ–π Telegram –∫–∞–Ω–∞–ª [@poxek](https://t.me/+MYjDCbCNAZoxZGNi)
